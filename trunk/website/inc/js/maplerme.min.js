$(document).ready(function(){$("body").on("click",".mention[status-id]",function(){var e=$(this).attr("poster");var b=$(this).attr("mentions").split(";");var a=$("#post-status");var d="@"+e;for(var c in b){if(b[c]==""){continue}if(b[c].toLowerCase()==window.MemberName.toLowerCase()){continue}if(d.indexOf(b[c])!=-1){continue}d+=" @"+b[c]}a.val(d+" ");$("#post").modal({show:true});$("input[name='reply-to']").attr("value",$(this).attr("status-id"));a.focus();return false});$("#post-status").keyup(function(){if($(this).val()==""&&$("input[name='reply-to']").attr("value")!=-1){$("input[name='reply-to']").attr("value",-1)}});$("#post-status").bind("focus",keypress.stop_listening);$("#post-status").bind("blur",keypress.listen);$("input[type=text]").bind("focus",keypress.stop_listening);$("input[type=text]").bind("blur",keypress.listen);$("input[type=password]").bind("focus",keypress.stop_listening);$("input[type=password]").bind("blur",keypress.listen);$("textarea").bind("focus",keypress.stop_listening);$("textarea").bind("blur",keypress.listen);$("body").on("click",".status[status-id]",function(d){var b=$(this).attr("status-id");var c=$(this).attr("unique-id");var a=$(this).find(".reply-list[status-id="+b+"]").first();if(a.html()!=""){a.html("")}else{$.ajax({type:"GET",url:"/api/status/"+b+"/",success:function(e){if(e.error!=undefined){alert(e.error)}else{a.html(e.result)}}})}return false});$("body").on("click",".status[status-id] a",function(a){a.stopPropagation()});$(".fademeout").delay(7000).fadeOut(1000,function(){$(this).remove()});$("body").on("mouseover","*[status-post-time]",function(a){$(this).attr("title",new Date($(this).attr("status-post-time")*1000))});$("#statusposter").submit(function(){$('#statusposter button[type="submit"]').attr("disabled","disabled");var a=$(this).serializeArray();var b="hirr";a.filter(function(d,c){if(d.name=="reply-to"){b=d.value}});$.ajax({type:"POST",url:"/api/status/post/",data:a,success:function(c){if(c.errormsg!=undefined){AddMessageToContent("alert","An error occurred: "+c.errormsg,"")}else{AddMessageToContent("info","Successfully posted status!","");$('textarea[name="content"]').val("");$('input[name="reply-to"]').attr("value","-1");$("#post").modal("hide")}$('#statusposter button[type="submit"]').removeAttr("disabled")}});return false});$("body").on("click",".deletestatus",function(){if(!confirm("Are you sure you want to delete this status?")){return false}var a=$(this).parent().parent();var b=a.attr("status-id");$.ajax({type:"GET",url:"/api/status/delete/"+b+"/",success:function(f){if(f.errormsg!=undefined){AddMessageToContent("alert","An error occurred: "+f.errormsg,"")}else{var d=a.find('div[class="character"]');var c=d.css("background-image");c=c.replace("url(","");c=c.replace(")","");c=c.replace(/"/g,"");d.css("background-image",'url("'+c+'?madface")');a.fadeOut(2000,function(){$(this).remove()})}}});return false});window.IsSyncing=false;window.syncer=function(c,a){if(typeof a==="undefined"){a=false}if(!a&&window.IsSyncing){return}if(a&&$("#syncbutton").html()=="Loading more statuses....."){return}if(a){$("#syncbutton").html("Loading more statuses.....")}window.IsSyncing=true;var e=[];$('div[class~="status"][status-id]').each(function(f){var g=parseInt($(this).attr("status-id"));if($.inArray(g,e)==-1){e.push(g)}});var d={"shown-statuses":e,"client-time":serverTickCount,url:document.location.href,"has-statusses":$("#statuslist").length>0?1:0};if(c){var b=serverTickCount;$("*[status-post-time]").each(function(){if(b>$(this).attr("status-post-time")){b=$(this).attr("status-post-time")}});d["client-time"]=b;d["older-than"]=true}else{var b=serverTickCount;$("*[status-post-time]").each(function(){if(b<$(this).attr("status-post-time")){b=$(this).attr("status-post-time")}});d["client-time"]=b}$.ajax({type:"POST",url:"/ajax/sync/",data:d,success:function(o){var g=window.document.title;if(o.loggedin==false&&window.location.pathname.indexOf("/stream/")!=-1){document.location="/login"}if(g.indexOf(") ")!=-1){g=g.substr(g.indexOf(") ")+2)}if(o.notifications>0){g="("+o.notifications+") "+g}if(o.membername!=undefined){window.MemberName=o.membername}window.document.title=g;if(typeof o.server_status!=="undefined"&&$("div[mapler-locale]").length>0){for(var p in o.server_status){var i=o.server_status[p];var l=i.status;var j=$('div[mapler-locale="'+p+'"]');if(l=="offline"){j.find("span[offline-server]").css("display","");j.find("span[online-server]").css("display","none")}else{j.find("span[offline-server]").css("display","");j.find("span[online-server]").css("display","none");j.find("span[version]").html(i.version);j.find("span[players]").html(i.players)}}}if(o.status_info!=undefined){if(o.status_info.deleted!=undefined){for(var h in o.status_info.deleted){var f=o.status_info.deleted[h];$('div[class~="status"][status-id="'+f+'"]').fadeOut(2000,function(){$(this).remove()})}}if(o.status_info.reply_count!=undefined){for(var f in o.status_info.reply_count){var n=o.status_info.reply_count[f];$('.status[status-id="'+f+'"]').find(".status-reply-count").html(n)}}}if(o.statuses!=undefined){for(var m in o.statuses){var l=o.statuses[m];var k=$($("*[status-post-time]").get().reverse()).filter(function(){return $(this).attr("status-post-time")>l[0]});if(k.length>0){$(l[1]).insertAfter(k.first().closest('div[class~="status"]'))}else{if(c){$("#statuslist").append(l[1])}else{$("#statuslist").prepend(l[1])}}}if(o.statuses.length==0&&serverTickCount==0){$("#statuslist").html('<p class="lead alert alert-info">No statuses to show!</p>')}}serverTickCount=o.time;memberName=o.membername;$("*[status-post-time]").each(function(q){$(this).html(time_elapsed_string(serverTickCount-$(this).attr("status-post-time"))+" ago")});window.IsSyncing=false;if(a){if(c&&o.statuses.length==0){$("#syncbutton").html("Nothing to show you :(").fadeOut(1000)}else{$("#syncbutton").html("Load more statuses..")}}}})};setInterval(function(){syncer(false)},8000);syncer(false)});var serverTickCount=0;var memberName="";function GetBlogPosts(a,b){$.ajax({type:"GET",url:"/api/blog/",success:function(c){if(c.errormsg!=undefined){alert(c.errormsg)}else{if(c.amount>0){if(a){$("#statuslist").prepend(c.result)}else{$("#statuslist").append(c.result)}if(b||!a){latestStatusDown=c.firstid}if(b||a){latestStatusUp=c.lastid}}}}})}function AddMessageToContent(b,d,a){var c=$("<p></p>");c.addClass("lead");c.addClass("alert");c.addClass("alert-"+b);c.html(d);c=$('<div class="span12"></div>').html(c);c=$('<div class="row"></div>').html(c);c.delay(7000).fadeOut(1000,function(){$(this).remove()});$('div[class="container main"]').prepend(c)}function time_elapsed_string(b){if(b<=1){return"moments"}var d={year:12*30*24*60*60,month:30*24*60*60,day:24*60*60,hour:60*60,minute:60};for(var a in d){var c=d[a];c=parseFloat(b/c);c=parseInt(Math.floor(c));if(c>=1){return c+" "+a+(c>1?"s":"")}}return"less than a minute"}function ChangePostAvatarFace(c){var b=$("#statusposter .character");var a=b.css("background-image");a=a.replace(/face=([a-z]*)/g,"face="+c);b.css("background-image",a)}jQuery("html").removeClass("no-js").addClass("js");if(navigator.appVersion.indexOf("Mac")!=-1){jQuery("html").addClass("osx")}if($.browser.opera){$(".fade").removeClass("fade");$(".slide").removeClass("slide")}jQuery(document).ready(function(b){(function(){b('<i id="back-to-top" class="icon-chevron-up"></i>').appendTo(b("body"));b(window).scroll(function(){if(b(this).scrollTop()!=0){b("#back-to-top").fadeIn()}else{b("#back-to-top").fadeOut()}});b("#back-to-top").click(function(){b("body,html").animate({scrollTop:0},600)})})();(function(){b(".faq input[type=text]").keyup(function(){var a=b(this).val().toLowerCase();if(a.length>3){b(".faq li").each(function(){var g=b(this).find("h3").text();var f=b(this).find("p").text();var h=(g+f).toLowerCase();if(h.indexOf(a)==-1){b(this).hide()}else{b(this).show()}});if(!b(".faq li:visible").length){b(".no-results").show()}else{b(".no-results").hide()}}else{b(".faq li").hide()}})})();keypress.combo("n",function(){$("#post").modal({show:true});input.focus()});keypress.combo("p",function(){window.location.href="//mapler.me/me/"})});