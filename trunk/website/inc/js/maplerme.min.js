$(document).ready(function(){$("body").on("click",".mention[status-id]",function(){var e=$(this).attr("poster");var b=$(this).attr("mentions").split(";");var a=$("#post-status");var d="@"+e;for(var c in b){if(b[c]==""){continue}if(b[c].toLowerCase()==window.MemberName.toLowerCase()){continue}if(d.indexOf(b[c])!=-1){continue}d+=" @"+b[c]}a.val(d+" ");$("#post").modal({show:true});$("input[name='reply-to']").attr("value",$(this).attr("status-id"));a.focus();return false});$("#post-status").keyup(function(){if($(this).val()==""&&$("input[name='reply-to']").attr("value")!=-1){$("input[name='reply-to']").attr("value",-1)}});$("#post-status").bind("focus",keypress.stop_listening);$("#post-status").bind("blur",keypress.listen);$("input[type=text]").bind("focus",keypress.stop_listening);$("input[type=text]").bind("blur",keypress.listen);$("input[type=password]").bind("focus",keypress.stop_listening);$("input[type=password]").bind("blur",keypress.listen);$("textarea").bind("focus",keypress.stop_listening);$("textarea").bind("blur",keypress.listen);$("body").on("click",".status[status-id]",function(d){var b=$(this).attr("status-id");var c=$(this).attr("unique-id");var a=$(this).find(".reply-list[status-id="+b+"]").first();if(a.html()!=""){a.html("")}else{$.ajax({type:"GET",url:"/api/status/"+b+"/",success:function(e){if(e.error!=undefined){alert(e.error)}else{a.html(e.result)}}})}return false});$("body").on("click",".status[status-id] a",function(a){a.stopPropagation()});$(".fademeout").delay(7000).fadeOut(1000,function(){$(this).remove()});$("body").on("mouseover","*[status-post-time]",function(a){$(this).attr("title",new Date($(this).attr("status-post-time")*1000))});$("#statusposter").submit(function(){$('#statusposter button[type="submit"]').attr("disabled","disabled");var a=$(this).serializeArray();var b="hirr";a.filter(function(d,c){if(d.name=="reply-to"){b=d.value}});$.ajax({type:"POST",url:"/api/status/post/",data:a,success:function(c){if(c.errormsg!=undefined){AddMessageToContent("alert","An error occurred: "+c.errormsg,"")}else{AddMessageToContent("info","Successfully posted status!","");$('textarea[name="content"]').val("");$('select[name="usingface"]').val("");$('input[name="reply-to"]').attr("value","-1");$("#post").modal("hide")}$('#statusposter button[type="submit"]').removeAttr("disabled")}});return false});$("body").on("click",".deletestatus",function(){if(!confirm("Are you sure you want to delete this status?")){return false}var a=$(this).parent().parent();var b=a.attr("status-id");$.ajax({type:"GET",url:"/api/status/delete/"+b+"/",success:function(f){if(f.errormsg!=undefined){AddMessageToContent("alert","An error occurred: "+f.errormsg,"")}else{var c=a.find('div[class="character"]');var d=c.css("background-image");d=d.replace(/face=([a-z]*)/g,"face=angry");c.css("background-image",d);a.fadeOut(2000,function(){$(this).remove()})}}});return false});window.IsSyncing=false;window.syncer=function(c,a){if(typeof a==="undefined"){a=false}if(!a&&window.IsSyncing){return}if(a&&$("#syncbutton").html()=="Loading more statuses....."){return}if(a){$("#syncbutton").html("Loading more statuses.....")}window.IsSyncing=true;var e=[];$('div[class~="status"][status-id]').each(function(f){var g=parseInt($(this).attr("status-id"));if($.inArray(g,e)==-1){e.push(g)}});var d={"shown-statuses":e,"client-time":serverTickCount,url:document.location.href,"has-statusses":$("#statuslist").length>0?1:0};if(c){var b=serverTickCount;$("*[status-post-time]").each(function(){if(b>$(this).attr("status-post-time")){b=$(this).attr("status-post-time")}});d["client-time"]=b;d["older-than"]=true}else{var b=serverTickCount;$("*[status-post-time]").each(function(){if(b<$(this).attr("status-post-time")){b=$(this).attr("status-post-time")}});d["client-time"]=b}$.ajax({type:"POST",url:"/ajax/sync/",data:d,success:function(o){var g=window.document.title;if(o.loggedin==false&&window.location.pathname.indexOf("/stream/")!=-1){document.location="/login"}if(g.indexOf(") ")!=-1){g=g.substr(g.indexOf(") ")+2)}if(o.notifications>0){g="("+o.notifications+") "+g}if(o.membername!=undefined){window.MemberName=o.membername}window.document.title=g;if(typeof o.server_status!=="undefined"&&$("div[mapler-locale]").length>0){for(var p in o.server_status){var i=o.server_status[p];var l=i.status;var j=$('div[mapler-locale="'+p+'"]');if(l=="offline"){j.find("span[offline-server]").css("display","");j.find("span[online-server]").css("display","none")}else{j.find("span[offline-server]").css("display","none");j.find("span[online-server]").css("display","");j.find("span[version]").html(i.version);j.find("span[players]").html(i.players)}}}if(o.status_info!=undefined){if(o.status_info.deleted!=undefined){for(var h in o.status_info.deleted){var f=o.status_info.deleted[h];$('div[class~="status"][status-id="'+f+'"]').fadeOut(2000,function(){$(this).remove()})}}if(o.status_info.reply_count!=undefined){for(var f in o.status_info.reply_count){var n=o.status_info.reply_count[f];$('.status[status-id="'+f+'"]').find(".status-reply-count").html(n)}}}if(o.statuses!=undefined){for(var m in o.statuses){var l=o.statuses[m];var k=$($("*[status-post-time]").get().reverse()).filter(function(){return $(this).attr("status-post-time")>l[0]});if(k.length>0){$(l[1]).insertAfter(k.first().closest('div[class~="status"]'))}else{if(c){$("#statuslist").append(l[1])}else{$("#statuslist").prepend(l[1])}}}if(o.statuses.length==0&&serverTickCount==0){$("#statuslist").html('<p class="lead alert alert-info">No statuses to show!</p>')}}serverTickCount=o.time;memberName=o.membername;memberStatuses=o.memberstatuses;$("#memberstatuses").html(memberStatuses+" statuses");$("*[status-post-time]").each(function(q){$(this).html(time_elapsed_string(serverTickCount-$(this).attr("status-post-time"))+" ago")});window.IsSyncing=false;if(a){if(c&&o.statuses.length==0){$("#syncbutton").html("Nothing to show you :(").fadeOut(1000)}else{$("#syncbutton").html("Load more statuses..")}}}})};setInterval(function(){syncer(false)},2500);syncer(false)});var serverTickCount=0;var memberName="";function GetBlogPosts(a,b){$.ajax({type:"GET",url:"/api/blog/",success:function(c){if(c.errormsg!=undefined){alert(c.errormsg)}else{if(c.amount>0){if(a){$("#statuslist").prepend(c.result)}else{$("#statuslist").append(c.result)}if(b||!a){latestStatusDown=c.firstid}if(b||a){latestStatusUp=c.lastid}}}}})}function AddMessageToContent(b,d,a){var c=$("<p></p>");c.addClass("lead");c.addClass("alert");c.addClass("alert-"+b);c.html(d);c=$('<div class="span12"></div>').html(c);c=$('<div class="row"></div>').html(c);c.delay(7000).fadeOut(1000,function(){$(this).remove()});$('div[class="container main"]').prepend(c)}function time_elapsed_string(b){if(b<=1){return"moments"}var d={year:12*30*24*60*60,month:30*24*60*60,day:24*60*60,hour:60*60,minute:60};for(var a in d){var c=d[a];c=parseFloat(b/c);c=parseInt(Math.floor(c));if(c>=1){return c+" "+a+(c>1?"s":"")}}return"less than a minute"}function ChangePostAvatarFace(c){var b=$("#statusposter .character");var a=b.css("background-image");a=a.replace(/face=([a-z]*)/g,"face="+c);b.css("background-image",a)}jQuery("html").removeClass("no-js").addClass("js");if(navigator.appVersion.indexOf("Mac")!=-1){jQuery("html").addClass("osx")}jQuery(document).ready(function(b){(function(){b('<i id="back-to-top" class="icon-chevron-up"></i>').appendTo(b("body"));b(window).scroll(function(){if(b(this).scrollTop()!=0){b("#back-to-top").fadeIn()}else{b("#back-to-top").fadeOut()}});b("#back-to-top").click(function(){b("body,html").animate({scrollTop:0},600)})})();(function(){b(".faq input[type=text]").keyup(function(){var a=b(this).val().toLowerCase();if(a.length>3){b(".faq li").each(function(){var g=b(this).find("h3").text();var f=b(this).find("p").text();var h=(g+f).toLowerCase();if(h.indexOf(a)==-1){b(this).hide()}else{b(this).show()}});if(!b(".faq li:visible").length){b(".no-results").show()}else{b(".no-results").hide()}}else{b(".faq li").hide()}})})();keypress.combo("n",function(){$("#post").modal({show:true});input.focus()});keypress.combo("p",function(){window.location.href="//mapler.me/me/"})});(function(a){function b(e){return e.replace(/(:|\.)/g,"\\$1")}var d="1.4.11",f={exclude:[],excludeWithin:[],offset:0,direction:"top",scrollElement:null,scrollTarget:null,beforeScroll:function(){},afterScroll:function(){},easing:"swing",speed:400,autoCoefficent:2,preventDefault:!0},c=function(g){var i=[],j=!1,h=g.dir&&"left"==g.dir?"scrollLeft":"scrollTop";return this.each(function(){if(this!=document&&this!=window){var e=a(this);e[h]()>0?i.push(this):(e[h](1),j=e[h]()>0,j&&i.push(this),e[h](0))}}),i.length||this.each(function(){"BODY"===this.nodeName&&(i=[this])}),"first"===g.el&&i.length>1&&(i=[i[0]]),i};a.fn.extend({scrollable:function(e){var g=c.call(this,{dir:e});return this.pushStack(g)},firstScrollable:function(e){var g=c.call(this,{el:"first",dir:e});return this.pushStack(g)},smoothScroll:function(h){h=h||{};var i=a.extend({},a.fn.smoothScroll.defaults,h),g=a.smoothScroll.filterPath(location.pathname);return this.unbind("click.smoothscroll").bind("click.smoothscroll",function(t){var k=this,z=a(this),w=i.exclude,o=i.excludeWithin,x=0,r=0,q=!0,y={},v=location.hostname===k.hostname||!k.hostname,l=i.scrollTarget||(a.smoothScroll.filterPath(k.pathname)||g)===g,j=b(k.hash);if(i.scrollTarget||v&&l&&j){for(;q&&w.length>x;){z.is(b(w[x++]))&&(q=!1)}for(;q&&o.length>r;){z.closest(o[r++]).length&&(q=!1)}}else{q=!1}q&&(i.preventDefault&&t.preventDefault(),a.extend(y,i,{scrollTarget:i.scrollTarget||j,link:k}),a.smoothScroll(y))}),this}}),a.smoothScroll=function(w,q){var j,g,k,x,u=0,l="offset",v="scrollTop",p={},m={};"number"==typeof w?(j=a.fn.smoothScroll.defaults,k=w):(j=a.extend({},a.fn.smoothScroll.defaults,w||{}),j.scrollElement&&(l="position","static"==j.scrollElement.css("position")&&j.scrollElement.css("position","relative"))),j=a.extend({link:null},j),v="left"==j.direction?"scrollLeft":v,j.scrollElement?(g=j.scrollElement,u=g[v]()):g=a("html, body").firstScrollable(),j.beforeScroll.call(g,j),k="number"==typeof w?w:q||a(j.scrollTarget)[l]()&&a(j.scrollTarget)[l]()[j.direction]||0,p[v]=k+u+j.offset,x=j.speed,"auto"===x&&(x=p[v]||g.scrollTop(),x/=j.autoCoefficent),m={duration:x,easing:j.easing,complete:function(){j.afterScroll.call(j.link,j)}},j.step&&(m.step=j.step),g.length?g.stop().animate(p,m):j.afterScroll.call(j.link,j)},a.smoothScroll.version=d,a.smoothScroll.filterPath=function(e){return e.replace(/^\//,"").replace(/(index|default).[a-zA-Z]{3,4}$/,"").replace(/\/$/,"")},a.fn.smoothScroll.defaults=f})(jQuery);